<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PDF Manager + PDF.js (Mobile First)</title>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
  /* GENEL SIFIRLAMALAR */
  body { 
    margin: 0; 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    height: 100vh; 
    overflow: hidden; 
    color: #333;
    background-color: #ffffff; 
    transition: background-color 0.3s, color 0.3s;
  }

  /* Dark Mode */
  body.dark-mode {
    background-color: #121212;
    color: #e0e0e0;
  }

  /* -----------------------------------------------
     MOBİL GENEL YAPI
  ------------------------------------------------- */
  #appContainer {
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
    position: relative;
  }

  /* -----------------------------------------------
     1. TOP BAR (ÜST ÇUBUK)
  ------------------------------------------------- */
  #topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 56px;
    background: #ffffff;
    color: #333;
    padding: 0 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    z-index: 10;
    transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
  }
  
  .dark-mode #topbar {
    background: #1e1e1e;
    color: #e0e0e0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  
  #topbar h1 {
      font-size: 1.2rem;
      font-weight: 500;
      margin: 0;
      margin-left: 5px; /* Hamburger menüden 5px uzak */
  }
  
  #topbar .icon-group button {
      background: none;
      border: none;
      color: #d32f2f;
      margin-left: 10px;
      cursor: pointer;
      padding: 5px;
      transition: color 0.3s;
  }
  
  .dark-mode #topbar .icon-group button {
      color: #f44336;
  }
  
  #topbar .icon-group button:hover {
      color: #b71c1c;
  }
  
  .dark-mode #topbar .icon-group button:hover {
      color: #ff6b6b;
  }

  /* -----------------------------------------------
     2. DRAWER (ÇEKMECE MENÜ)
  ------------------------------------------------- */
  #drawer {
    position: fixed;
    top: 0;
    left: 0;
    height: 100%;
    width: 280px; 
    background: #ffffff;
    box-shadow: 2px 0 5px rgba(0,0,0,0.5);
    z-index: 2000;
    transform: translateX(-100%);
    transition: transform 0.3s ease-out, background-color 0.3s;
    display: flex;
    flex-direction: column;
  }
  
  .dark-mode #drawer {
    background: #1e1e1e;
    box-shadow: 2px 0 5px rgba(0,0,0,0.7);
  }

  #drawer.open {
    transform: translateX(0);
  }

  #drawer-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1999;
    display: none;
  }
  
  #drawer-overlay.open {
      display: block;
  }

  #drawer header {
    padding: 20px;
    font-size: 1.4rem;
    font-weight: 600;
    color: #d32f2f;
    border-bottom: 1px solid #eee;
    transition: color 0.3s, border-color 0.3s;
  }
  
  .dark-mode #drawer header {
    color: #f44336;
    border-bottom-color: #333;
  }

  #drawer ul {
    list-style: none;
    padding: 10px 0;
    margin: 0;
  }

  #drawer ul li {
    display: flex;
    align-items: center;
    padding: 12px 20px;
    cursor: pointer;
    transition: background-color 0.2s;
    color: #333;
  }
  
  .dark-mode #drawer ul li {
    color: #e0e0e0;
  }
  
  #drawer ul li:hover {
      background-color: #ffebee;
  }
  
  .dark-mode #drawer ul li:hover {
      background-color: #3a1f1f;
  }

  #drawer ul li .material-icons {
      margin-right: 15px;
      color: #d32f2f;
      transition: color 0.3s;
  }
  
  .dark-mode #drawer ul li .material-icons {
      color: #f44336;
  }
  
  #drawer-import-input {
      display: none; 
  }

  /* -----------------------------------------------
     3. CONTENT AREA (İçerik Alanı: Sidebar)
  ------------------------------------------------- */
  #sidebar { 
    flex-grow: 1; 
    display: flex; 
    flex-direction: column;
    padding: 20px; 
    box-sizing: border-box; 
    overflow-y: auto;
    margin-bottom: 56px; 
    transition: background-color 0.3s;
  }
  
  .dark-mode #sidebar {
    background-color: #121212;
  }

  #sidebar h4 { 
    margin-top: 0; 
    margin-bottom: 10px; 
    font-weight: 500; 
    color: #d32f2f;
    transition: color 0.3s;
  }
  
  .dark-mode #sidebar h4 {
    color: #f44336;
  }

  /* PDF Listesi Stili */
  #list {
    list-style: none;
    padding: 0;
    width: 100%;
    max-width: none;
    margin-top: 0;
    text-align: left;
  }

  #list li { 
    cursor: pointer; 
    margin: 8px 0; 
    padding: 10px 15px; 
    border-radius: 6px; 
    transition: background 0.2s, box-shadow 0.2s, border-color 0.2s; 
    border: 1px solid #e0e0e0;
    background: #ffffff;
    box-shadow: 0 1px 3px rgba(0,0,0,0.03);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  .dark-mode #list li {
    background: #1e1e1e;
    border-color: #333;
    color: #e0e0e0;
  }

  #list li:hover { 
    background: #ffebee; 
    border-color: #d32f2f;
    box-shadow: 0 2px 5px rgba(211,47,47,0.1);
  }
  
  .dark-mode #list li:hover {
    background: #3a1f1f;
    border-color: #f44336;
    box-shadow: 0 2px 5px rgba(244,67,54,0.2);
  }

  /* -----------------------------------------------
     4. BOTTOM BAR (Alt Çubuk)
  ------------------------------------------------- */
  #bottombar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 56px;
    background: #ffffff;
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
    z-index: 10;
    transition: background-color 0.3s, box-shadow 0.3s;
  }
  
  .dark-mode #bottombar {
    background: #1e1e1e;
    box-shadow: 0 -2px 4px rgba(0,0,0,0.3);
  }

  .bottom-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #757575;
    font-size: 0.7rem;
    cursor: pointer;
    padding: 5px 0;
    transition: all 0.3s ease;
    flex: 1;
    position: relative;
  }
  
  .dark-mode .bottom-item {
    color: #aaa;
  }
  
  .bottom-item .material-icons {
    color: #757575;
    transition: all 0.3s ease;
    font-size: 22px;
  }
  
  .dark-mode .bottom-item .material-icons {
    color: #aaa;
  }
  
  .bottom-item .item-label {
      margin-top: 2px;
      transition: all 0.3s ease;
  }

  /* Aktif öğe stilleri */
  .bottom-item.active {
    color: #d32f2f;
  }
  
  .bottom-item.active .material-icons {
    color: #d32f2f;
    transform: scale(1.1);
  }
  
  .dark-mode .bottom-item.active {
    color: #f44336;
  }
  
  .dark-mode .bottom-item.active .material-icons {
    color: #f44336;
  }

  /* Hover efektleri */
  .bottom-item:hover {
    color: #d32f2f;
  }
  
  .bottom-item:hover .material-icons {
    color: #d32f2f;
    transform: translateY(-2px);
  }
  
  .dark-mode .bottom-item:hover {
    color: #f44336;
  }
  
  .dark-mode .bottom-item:hover .material-icons {
    color: #f44336;
  }

  /* Aktif öğe için alt çizgi efekti */
  .bottom-item.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 25%;
    width: 50%;
    height: 3px;
    background: #d32f2f;
    border-radius: 2px;
  }
  
  .dark-mode .bottom-item.active::after {
    background: #f44336;
  }

  /* -----------------------------------------------
     PDF VIEW AREA (Görüntüleyici Alanı SABİT)
  ------------------------------------------------- */
  #pdfViewerArea {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 100;
    display: none; /* Kurala uyum: Tıklama öncesi ASLA GÖRÜNMEZ */
    background: #f5f5f5;
    transition: background-color 0.3s;
  }
  
  /* Dark mode sadece PDF görüntüleyici arka planını ve toolbar'ı etkiler */
  .dark-mode #pdfViewerArea {
    background: #2d2d2d;
  }

  /* PDF Görüntüleyici içindeki Topbar (Kuralı Bozmayan Topbar) */
  #toolbar {
    top: 0; 
    height: 56px; 
    background: #d32f2f; 
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    display: none; 
    
    position: fixed;
    left: 0;
    width: 100%;
    align-items: center; 
    justify-content: center;
    padding: 0 10px;
    box-sizing: border-box;
    z-index: 1000;
    transition: background-color 0.3s;
  }
  
  /* Dark mode sadece toolbar'ı etkiler */
  .dark-mode #toolbar {
    background: #c62828;
  }

  /* PDF Görüntüleyici içindeki iframe */
  #pdfFrame {
      position: absolute;
      top: 56px; 
      left: 0;
      width: 100%;
      height: calc(100% - 56px); 
      border: none;
      background: white; /* PDF içeriği her zaman beyaz arka planda */
  }

  /* PDF içeriğini dark mode'dan koru - sadece arka plan etkilensin */
  .dark-mode #pdfFrame {
      /* PDF içeriği değişmez, sadece dış arka plan koyu olur */
  }

  #toolbar button {
      position: absolute;
      left: 15px;
      font-size: 24px;
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      padding: 5px;
      transition: color 0.3s;
  }
  
  .dark-mode #toolbar button {
    color: #fff;
  }

  #toolbar #pdfName {
      max-width: 60%;
      color: #fff;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: color 0.3s;
  }
  
  .dark-mode #toolbar #pdfName {
    color: #fff;
  }


/* --- Flutter WebView düzeltmeleri --- */
html, body {
  -webkit-text-size-adjust: 100%;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  font-smooth: always;
}

#appContainer {
  max-width: 100vw;
  max-height: 100vh;
  overflow: hidden;
}

button, .material-icons {
  -webkit-tap-highlight-color: transparent;
}
  
</style>
</head>
<body>

<div id="appContainer">

  <div id="drawer-overlay"></div>
  <div id="drawer">
    <header>PDF Reader & Manager</header>
    <ul>
      <li id="drawer-import"><span class="material-icons">cloud_upload</span> Import PDF</li>
      <input type="file" id="drawer-import-input" accept="application/pdf" multiple />
      
      <li id="drawer-about"><span class="material-icons">info</span> About</li>
      <li id="drawer-theme"><span class="material-icons">dark_mode</span> <span class="theme-text">Dark Mode</span></li>
      <li id="drawer-policy"><span class="material-icons">policy</span> Policy</li>
      <li id="drawer-language"><span class="material-icons">language</span> Language</li>
    </ul>
  </div>

  <div id="topbar">
    <div style="display: flex; align-items: center;">
        <button id="menuBtn" title="Menü"><span class="material-icons" style="color: #d32f2f;">menu</span></button>
        <h1 id="dynamicTitle">All Files</h1>
    </div>
    <div class="icon-group">
      <button title="Arama"><span class="material-icons">search</span></button>
      <button title="Klasör Oluştur"><span class="material-icons">create_new_folder</span></button>
      <button title="Sıralama"><span class="material-icons">sort</span></button>
      <button title="Seçim Modu"><span class="material-icons">check_box</span></button>
    </div>
  </div>

  <div id="sidebar">
    <h4>Seçilen PDF'ler:</h4>
    <ul id="list">
        <li style="text-align: center; color: #757575; border: none; box-shadow: none; cursor: default;">Henüz dosya seçilmedi...</li>
    </ul>
  </div>

  <div id="bottombar">
    <div class="bottom-item active" data-view="all-files">
      <span class="material-icons">folder</span>
      <span class="item-label">All Files</span>
    </div>
    <div class="bottom-item" data-view="recent">
      <span class="material-icons">history</span>
      <span class="item-label">Recent</span>
    </div>
    <div class="bottom-item" data-view="favorites">
      <span class="material-icons">favorite</span>
      <span class="item-label">Favorites</span>
    </div>
    <div class="bottom-item" data-view="tools">
      <span class="material-icons">settings</span>
      <span class="item-label">Tools</span>
    </div>
  </div>

</div> 

<div id="pdfViewerArea">
    <div id="toolbar">
        <button id="backBtn" title="Listeye Geri Dön"><span class="material-icons">arrow_back</span></button>
        <span id="pdfName">PDF Viewer</span>
    </div>
    <iframe id="pdfFrame" src="viewer.html"></iframe> 
</div>


<script>
const picker = document.getElementById('drawer-import-input'); 
const list = document.getElementById('list');
const iframe = document.getElementById('pdfFrame');
const pdfViewerArea = document.getElementById('pdfViewerArea'); 
const toolbar = document.getElementById('toolbar');
const backBtn = document.getElementById('backBtn');
const pdfNameSpan = document.getElementById('pdfName');
const sidebar = document.getElementById('sidebar');

const menuBtn = document.getElementById('menuBtn');
const drawer = document.getElementById('drawer');
const drawerOverlay = document.getElementById('drawer-overlay');
const drawerImport = document.getElementById('drawer-import'); 
const bottomItems = document.querySelectorAll('.bottom-item');
const dynamicTitle = document.getElementById('dynamicTitle');
const themeToggle = document.getElementById('drawer-theme');
const themeIcon = themeToggle.querySelector('.material-icons');
const themeText = themeToggle.querySelector('.theme-text');

let files = [];
let isDarkMode = false;

// -----------------------------------------------
// MOBİL NAVİGASYON VE ETKİLEŞİMLER
// -----------------------------------------------

function toggleDrawer() {
    drawer.classList.toggle('open');
    drawerOverlay.classList.toggle('open');
}

menuBtn.addEventListener('click', toggleDrawer);
drawerOverlay.addEventListener('click', toggleDrawer);

// Import PDF öğesine tıklandığında gizli file input'u tetikle
drawerImport.addEventListener('click', () => { 
    picker.click(); 
    toggleDrawer(); 
});

// Tema değiştirme işlevi
function toggleTheme() {
    isDarkMode = !isDarkMode;
    document.body.classList.toggle('dark-mode', isDarkMode);
    
    // İkon ve metni güncelle
    if (isDarkMode) {
        themeIcon.textContent = 'light_mode';
        themeText.textContent = 'Light Mode';
    } else {
        themeIcon.textContent = 'dark_mode';
        themeText.textContent = 'Dark Mode';
    }
    
    // Eğer PDF görüntüleyici açıksa, sadece arka plan ve toolbar temasını güncelle
    if (pdfViewerArea.style.display === 'block') {
        // PDF içeriği değişmez, sadece dış arka plan ve toolbar koyu olur
        console.log('PDF Viewer arka plan ve toolbar teması güncellendi');
    }
}

themeToggle.addEventListener('click', () => {
    toggleTheme();
    toggleDrawer();
});

// Diğer Drawer sekmeleri
document.getElementById('drawer-about').addEventListener('click', () => { alert("About tıklandı."); toggleDrawer(); });
document.getElementById('drawer-policy').addEventListener('click', () => { alert("Policy tıklandı."); toggleDrawer(); });
document.getElementById('drawer-language').addEventListener('click', () => { alert("Dil değiştirme tıklandı."); toggleDrawer(); });


// BOTTOM BAR (Alt Çubuk) İşlevselliği - BAŞLIK DÜZELTİLMİŞ HALİ
bottomItems.forEach(item => {
    item.addEventListener('click', () => {
        bottomItems.forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        // Sadece .item-label içindeki metni alıyoruz (örn: "Recent")
        const titleText = item.querySelector('.item-label').textContent.trim(); 
        
        // Dinamik başlığı güncelle (örn: "Recent")
        dynamicTitle.textContent = titleText; 
        
        const view = item.getAttribute('data-view');
        
        // Sadece 'All Files' seçildiğinde sidebar'ı göster
        if (view === 'all-files') {
            sidebar.style.display = 'flex'; 
        } else {
            sidebar.style.display = 'none'; 
        }
    });
});


// -----------------------------------------------
// DOSYA YÖNETİMİ
// -----------------------------------------------

function updateFileList(fileArray) {
    fileArray.forEach(f => {
        if (!files.some(existingF => existingF.name === f.name)) {
            files.push(f);
        }
    });

    list.innerHTML = ''; 
    
    if (files.length === 0) {
        list.innerHTML = '<li style="text-align: center; color: #757575; border: none; box-shadow: none; cursor: default;">Henüz dosya seçilmedi...</li>';
        return;
    }
    
    files.forEach(f => {
      const li = document.createElement('li');
      li.textContent = f.name;
      li.onclick = () => openInViewer(f);
      list.appendChild(li);
    });
}

// Picker (Gizli Input) Değişiklik Olayı
picker.addEventListener('change', e => {
    updateFileList(Array.from(e.target.files)); 
    e.target.value = null; 
});


// -----------------------------------------------
// PDF GÖRÜNTÜLEYİCİ MANTIĞI (KURAL SABİT)
// -----------------------------------------------
function openInViewer(file) {
  const blobUrl = URL.createObjectURL(file);
  
  // PDF görüntüleyiciyi aç - tema parametresi ekleme (artık gerek yok)
  iframe.src = `viewer.html?file=${encodeURIComponent(blobUrl)}`;
  
  // KURAL: PDF TIKLANINCA GİZLİLER GÖRÜNÜR OLUR
  pdfViewerArea.style.display = 'block';   
  toolbar.style.display = 'flex';         
  
  // Diğer tüm ana arayüz bileşenlerini GİZLE
  document.getElementById('topbar').style.display = 'none';
  document.getElementById('bottombar').style.display = 'none';
  document.getElementById('sidebar').style.display = 'none';
  
  pdfNameSpan.textContent = file.name; 
}

// -----------------------------------------------
// GÖRÜNTÜLEYİCİDEN ÇIKIŞ (KURAL SABİT)
// -----------------------------------------------
backBtn.addEventListener('click', () => {
  // KURAL: GİZLİLER TEKRAR GİZLENİR
  pdfViewerArea.style.display = 'none';   
  toolbar.style.display = 'none';         
  
  // Ana arayüz bileşenlerini GÖSTER
  document.getElementById('topbar').style.display = 'flex';
  document.getElementById('bottombar').style.display = 'flex';
  
  // Bottom Bar'da aktif olan sekme 'All Files' ise sidebar'ı göster
  const activeView = document.querySelector('.bottom-item.active').getAttribute('data-view');
  if (activeView === 'all-files') {
      document.getElementById('sidebar').style.display = 'flex';
  }

  // Görüntüleyici iframe'i temizle
  iframe.src = 'about:blank';
});

// Sayfa yüklendiğinde tema durumunu kontrol et
document.addEventListener('DOMContentLoaded', function() {
    // Varsayılan olarak light mode
    isDarkMode = false;
    themeIcon.textContent = 'dark_mode';
    themeText.textContent = 'Dark Mode';
});
</script>
</body>
</html>
